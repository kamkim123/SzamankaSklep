<!DOCTYPE html>
<html lang="pl">
<head>
    <!-- TEMPLATE: products/index.html -->
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Szamanka-products</title>

    {% load static %}

    <!-- jeśli plik masz w static/ -> np. static/products.css -->
    <link rel="stylesheet" href="{% static 'products/products.css' %}">


    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap"
          rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Delius+Swash+Caps&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
          rel="stylesheet">
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js" crossorigin="anonymous"></script>


    <script>
        var cartAddUrl = "{% url 'orders:cart_add' %}";
    </script>

</head>
<body>

<form method="get" id="navFilterForm" style="display:none">
    <input type="hidden" name="type" id="navTypeInput" value="{{ selected|default:'' }}">
</form>


{% include "products/navbar.html" %}

<section class="products-section" id="products-section">
    <div class="products-wrapper">

        <!-- LEWE MENU: zostawiam statyczne, żeby wygląd nie uciekł -->
        <div class="products-menu">
            <div class="products-menu-item-title">Kategorie</div>
            <div class="products-menu-item">
                <a href="{% url 'products:produkty' %}?promocje=true" class="title-link">Promocje</a>
                <a href="{% url 'products:produkty' %}?bestsellers=true" class="title-link" id="bestsellers-link">Bestsellery</a>
                <a href="{% url 'products:produkty' %}?nowosci=true" class="title-link">Nowosci</a>
            </div>

            <div class="products-menu-item">
                <span class="title-link title-link1" data-type="spozywcze">Artykuły spożywcze</span>
                <p class="products-menu-p">Mąki</p>
                <p class="products-menu-p">Orzechy</p>
                <p class="products-menu-p">Przekąski</p>
                <p class="products-menu-p">Miody</p>
                <p class="products-menu-p">Inne</p>
            </div>

            <div class="products-menu-item">
                <span class="title-link" data-type="suplementy">Suplementy diety</span>
            </div>

            <div class="products-menu-item">
                <span class="title-link" id="title-only-no-link">Kosmetyki</span>

                <div class="submenu-block">
                    <a href="#" class="products-menu-link subtitle-link" data-type="kosmetyki do twarzy">Do twarzy</a>
                    <button class="submenu-toggle" type="button" aria-label="Rozwiń Do twarzy"></button>
                </div>
                <div class="submenu-panel">
                    <p class="products-cat2" data-type="Hydrolaty">Hydrolaty</p>
                    <p class="products-cat2" data-type="Olejki pod oczy">Olejki&nbsp;pod oczy</p>
                    <p class="products-cat2" data-type="Kosmetyki kolorowe">Kosmetyki kolorowe</p>
                    <p class="products-cat2" data-type="Pomadki do ust">Pomadki do ust</p>
                    <p class="products-cat2" data-type="Maseczki">Maseczki</p>
                    <p class="products-cat2" data-type="Kremy">Kremy</p>
                    <p class="products-cat2" data-type="Peelingi">Peelingi</p>
                    <p class="products-cat2" data-type="Zele i pianki">Żele i pianki</p>
                    <p class="products-cat2" data-type="Serum">Serum</p>
                    <p class="products-cat2" data-type="Plyny nicelarne">Płyny nicelarne</p>
                </div>

                <div class="submenu-block">
                    <a href="#" class="products-menu-link subtitle-link" data-type="kosmetyki do ciała">Do ciała</a>
                    <button class="submenu-toggle" type="button" aria-label="Rozwiń Do ciała"></button>
                </div>
                <div class="submenu-panel">
                    <p class="products-cat2"  data-type="Dezodoranty">Dezodoranty</p>
                    <p class="products-cat2"  data-type="Sole">Sole</p>
                    <p class="products-cat2"  data-type="Olejki">Olejki</p>
                    <p class="products-cat2"  data-type="Zele do mycia">Żele do mycia</p>
                    <p class="products-cat2"  data-type="Peelingi">Peelingi</p>
                    <p class="products-cat2"  data-type="Mydla">Mydła</p>
                    <p class="products-cat2"  data-type="Higiena intymna">Higiena intymna</p>
                    <p class="products-cat2"  data-type="Balsamy">Balsamy</p>
                </div>

                <div class="submenu-block">
                    <a href="#" class="products-menu-link subtitle-link" data-type="kosmetyki do włosów">Do włosów</a>
                    <button class="submenu-toggle" type="button" aria-label="Rozwiń Do włosów"></button>
                </div>
                <div class="submenu-panel">
                    <p class="products-cat2" data-type="Odzywki i maski">Odżywki i maski</p>
                    <p class="products-cat2" data-type="Wcierki">Wcierki</p>
                    <p class="products-cat2" data-type="Olejki">Olejki</p>
                    <p class="products-cat2" data-type="Szampony">Szampony</p>
                    <p class="products-cat2" data-type="Farby">Farby</p>
                    <p class="products-cat2" data-type="Akcesoria">Akcesoria</p>
                    <p class="products-cat2" data-type="Peelingi">Peelingi</p>
                </div>
            </div>

            <div class="products-menu-item">
                <span class="title-link" data-type="masci">Maści</span>
                <p class="products-menu-p" data-type="Przeciwbolowe">Przeciwbólowe</p>
                <p class="products-menu-p" data-type="Problemy skorne">Problemy skórne</p>
                <p class="products-menu-p" data-type="Inne">Inne</p>
            </div>
            <div class="products-menu-item">
                <span class="title-link" data-type="ziola">Zioła</span>
            </div>
            <div class="products-menu-item">
                <span class="title-link" data-type="inne">Inne</span>
                <p class="products-menu-p" data-type="Perfumy">Perfumy</p>
                <p class="products-menu-p" data-type="Dyfuzory">Dyfuzory</p>
                <p class="products-menu-p" data-type="Olejki eteryczne">Olejki eteryczne</p>
                <p class="products-menu-p" data-type="Swiece zapachowe">Świece zapachowe</p>
                <p class="products-menu-p" data-type="Poduszki">Poduszki</p>
                <p class="products-menu-p" data-type="Pasty do zebow">Pasty do zębów</p>
            </div>
        </div>

        <form method="get" class="mb-4">
            <label for="type">Kategoria:</label>
            <select name="type" id="type" onchange="this.form.submit()">
                <option value="">Wszystkie</option>
                {% for c in categories %}
                  <option value="{{ c.value }}"
                          {% if selected == c.value %}selected{% endif %}>
                    {{ c.label }}
                  </option>
                {% endfor %}

            </select>
            <noscript>
                <button type="submit">Filtruj</button>
            </noscript>
        </form>


        <div class="all-products">
            <div class="sort-by">sort&nbsp;by:</div>
            <div class="sort-wrapper">
                <div class="sort">Produkty</div>
                <div class="caret"></div>
                <ul class="sort-list">
                    <li>
                        <a href="{% url 'products:produkty' %}?najpopularniejsze=true">Najpopularniejsze</a>
                    </li>

                    <li>
                        <a href="{% url 'products:produkty' %}?nowosci=true">Nowości</a>
                    </li>

                    <li>
                        <a href="{% url 'products:produkty' %}?promocje=true">Promocje</a>
                    </li>
                    <li>
                        <a href="{% url 'products:produkty' %}?bestsellers=true">Bestsellery</a>
                    </li>
                </ul>
            </div>


            {% if products %}

            {% for p in products %}
            <div class="product{% if p.is_promotion %} product--promo{% endif %}" data-stock="{{ p.product_stock|default:9999 }}">
              {% if p.is_promotion %}
                <span class="badge badge--promo">Promocja</span>
              {% endif %}

                <a href="{% url 'products:detail' p.pk %}">
                    <img
                        src="{% if p.product_image %}{{ p.product_image }}{% else %}{% static 'products/images/default-image.png' %}{% endif %}"
                        alt="{{ p.product_name }}"
                        class="product-image">
                </a>

                <h3>
                    <a href="{% url 'products:detail' p.pk %}">{{ p.product_name }}</a>
                </h3>

                {% if p.has_promo %}
                  <div class="price price--wrap">
                      <span class="price__old">{{ p.price|floatformat:2 }} zł</span>
                      <p class="price__new">{{ p.final_price|floatformat:2 }} zł</p>
                  </div>
                {% else %}
                  <h4 class="price">{{ p.price|floatformat:2 }} zł</h4>
                {% endif %}

                <form method="post" action="{% url 'orders:cart_add' %}">
                    {% csrf_token %}
                    <input type="hidden" name="product_id" value="{{ p.pk }}">
                    <input type="hidden" name="quantity" value="1">

                    <div class="products-cart">
                        <button type="submit" class="cart-icon" data-product-id="{{ p.pk }}">
                            <img src="{% static 'products/images/shopping-cart-white.png' %}" alt="cart" class="cart-icon"/>
                        </button>
                    </div>
                </form>

                <a href="javascript:void(0);" class="favorite-toggle" data-product-id="{{ p.pk }}">
                    <i class="bx bx-heart {% if p.pk in favorite_product_ids %}bxs-heart{% endif %}"
                       style="{% if p.pk in favorite_product_ids %}color: red;{% endif %}"></i>
                </a>

                <div class="calc-product">
                    <button type="button" class="minus" aria-label="zmniejsz ilość">-</button>
                    <div class="calc-input" data-min="1">01</div>
                    <button type="button" class="plus" aria-label="zwiększ ilość">+</button>
                </div>
            </div>
            {% endfor %}


            <!-- „Więcej produktów” = następna strona paginacji -->
            <div class="pagination">
                {% if page_obj.has_previous %}
                <a href="?{% if selected %}type={{ selected }}&{% endif %}q={{ q|urlencode }}&page={{ page_obj.previous_page_number }}">←&nbsp;Poprzednia</a>
                {% endif %}

                <span>Strona {{ page_obj.number }} z {{ page_obj.paginator.num_pages }}</span>

                {% if page_obj.has_next %}
                <a href="?{% if selected %}type={{ selected }}&{% endif %}q={{ q|urlencode }}&page={{ page_obj.next_page_number }}">Następna&nbsp;→</a>
                {% endif %}
            </div>
            {% else %}
            <p>Brak produktów.</p>
            {% endif %}
        </div>

    </div>
</section>


{% include "products/footer.html" %}



<script src="{% static 'products/products.js' %}"></script>



</body>
</html>
