<!doctype html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    {% load static l10n %}

    <title>Koszyk – Szamanka</title>
    <meta name="robots" content="noindex,nofollow">

    <link rel="canonical" href="https://www.szamankasklep.pl{% url 'orders:cart' %}">

    <link rel="stylesheet" href="{% static 'orders/cart.css' %}">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" crossorigin="anonymous"></script>
</head>

<body>
{% include "products/navbar.html" %}



<div class="container">

    <form id="non-visible-form" method="post">
        {% csrf_token %}
        <input type="text" id="search-input" placeholder="Szukaj...">
        <div id="live-results" class="not-visible"></div>
    </form>
    <section class="card"><h2>Koszyk</h2>
        <ul class="cart-list" id="cartList"> {% for item in cart %}
            <li class="item3"
                data-product-id="{{ item.product.id }}"
                data-price="{{ item.price|unlocalize|floatformat:2 }}"
                data-update-url="{% url 'orders:cart_update' %}">
                <img src="{% if item.product.product_image %}{{ item.product.product_image }}{% else %}{% static 'products/images/default-image.png' %}{% endif %}"
                     alt="{{ item.product.product_name }}" class="cart-product-image"/>

                <div class="info">
                    <h3>{{ item.product.product_name }}</h3>
                </div>

                <div class="price"
                     data-unit-price="{{ item.price|unlocalize|floatformat:2 }}">
                    {{ item.price }}&nbsp;zł
                </div>

                <div class="qty">
                    <button class="qty-btn qty-minus" aria-label="Zmniejsz ilość">-</button>
                    <span class="qty-display">{{ item.quantity }}</span>
                    <button class="qty-btn qty-plus" aria-label="Zwiększ ilość">+</button>
                </div>

                <button class="remove" aria-label="Usuń" data-url="{% url 'orders:cart_remove' %}">×</button>
            </li>

            {% empty %}
            <li class="empty-cart">Twój koszyk jest pusty.</li>
            {% endfor %}
        </ul>
    </section>


    <aside class="card"><h2>Podsumowanie</h2>
        <div class="summary">
          <div class="row1"><span>Wartość produktów</span><span id="subtotal">{{ cart.subtotal }} zł</span></div>

          <div class="row1">
            <span>Dostawa <span class="badge">od 0 zł do 50 zł</span></span>
            <span id="shipping"></span>
          </div>

          {% if cart.discount_amount and cart.discount_amount != 0 %}
          <div class="row1">
            <span>Rabat{% if cart.coupon_code %} ({{ cart.coupon_code }}){% endif %}</span>
            <span id="discount">-{{ cart.discount_amount }} zł</span>
          </div>
          {% endif %}

          <div class="row1 total"><span>Do zapłaty</span><span id="grand">{{ cart.grand_total }} zł</span></div>

          <a href="{% url 'orders:checkout' %}">
            <button class="go_btn" id="checkoutBtn">Przejdź do płatności</button>
          </a>
        </div>

        <!-- Kupon (DESKTOP: pod podsumowaniem) -->
        <!-- Kupon (kompaktowo, bez osobnego przycisku "Usuń") -->
        <div class="coupon-box">
          <form method="post" action="{% url 'orders:cart_apply_coupon' %}" class="coupon-form">
            {% csrf_token %}

            <div class="coupon-head">
              <label for="coupon_code_d" class="coupon-label">Kod rabatowy (opcjonalnie)</label>

              {% if cart.coupon_code %}
                <span class="coupon-active">
                  Aktywny: <strong>{{ cart.coupon_code }}</strong>
                </span>
              {% endif %}
            </div>

            <div class="coupon-row">
              <input
                id="coupon_code_d"
                name="coupon_code"
                type="text"
                placeholder="np. SZAMANKA"
                value="{{ cart.coupon_code }}"
                autocomplete="off"
              />
              <button type="submit" class="coupon-btn">Zastosuj</button>
            </div>

            {% if cart.coupon_code %}
              <p class="coupon-hint">
                Aby usunąć kupon: wyczyść pole i kliknij <strong>„Zastosuj”</strong>.
              </p>
            {% endif %}
          </form>
        </div>


    </aside>


</div>
{% include "products/footer.html" %}
<script src="{% static 'orders/cart.js' %}"></script>
<script src="{% static 'products/detail.js' %}"></script>

</body>
</html>